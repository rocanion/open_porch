.columns
  %h2 Areas
  :javascript

    $(document).ready(function() {
      draw_chart({
        days : #{@activities.collect{|d| d.day.strftime('%d<br/>%m')}.to_json}, 
        series : [
          {
            name: 'New Users',
            data : #{@activities.collect{|a| a.sum_new_users_count.to_i}.to_json}
          }, 
          {
            name: 'Quitters',
            data : #{@activities.collect{|a| a.sum_quitters_count.to_i}.to_json}
          },
          {
            name: 'New Posts',
            data : #{@activities.collect{|a| a.sum_new_posts_count.to_i}.to_json}
          },
          {
            name: 'Issues Published',
            data : #{@activities.collect{|a| a.sum_issues_published_count.to_i}.to_json}
          }
        ]
      });
    })   
  
  = will_paginate @areas
  
  = form_for @search, :url => [:admin, :areas], :html => {:method => :get} do |f|
    = f.label :full_name_search, 'Find by name'
    = f.text_field :full_name_search, :style => 'width: 150px'
    = text_field_tag :activity_start_date,  params[:activity_start_date], :style => 'width: 150px', :type => :date
    = text_field_tag :activity_end_date,    params[:activity_end_date], :style => 'width: 150px', :type => :date
    = f.submit 'Find'
  
  #chart-container{:style=>"width: 100%; height: 400px"}
  
  %table
    %tr
      %th= sort_link @search, :name
      %th= sort_link @search, :city
      %th.center= sort_link @search, :memberships_count, 'Users'
      %th.center= sort_link @search, :households
      %th.center Send mode
      %th.center= sort_link @search, :issues_count, 'Issues'
      %th.center New posts
      
    - @areas.each do |area|
      %tr{:class => @new_posts[area.id] && @new_posts[area.id] > 0 ? 'important' : ''}
        %td= link_to area.name, [:edit_borders, :admin, area]
        %td= area.location
        %td.center= link_to area.memberships_count.to_i, [:admin, area, :memberships]
        %td.center= area.households.to_i
        %td.center= area.send_mode_name
        %td.center= link_to area.issues_count.to_i, [:admin, area, :issues]
        %td.center= link_to @new_posts[area.id].to_s, [:admin, area]
  
  = will_paginate @areas
  