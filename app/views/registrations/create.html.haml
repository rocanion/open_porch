= content_for :head do
  = javascript_include_tag "http://maps.google.com/maps/api/js?sensor=false"
  = javascript_include_tag 'google_maps'


= content_for :doc_ready do
  initialize(document.getElementById("map_canvas"), #{@address.lat}, #{@address.lng});
  center_marker = add_marker(#{@address.lat}, #{@address.lng}, '#{@address.full}');
  add_region(#{@selected_area.id}, [#{@selected_area.border_coordinates}], 'selected')
  - @areas.each do |area|
    add_region(#{area.id}, [#{area.border_coordinates}])


%h1 Confirm your Neighbourhood

%p The red icons mark your address. Please select the option that has a red outline surrounding your address (zoom in/out with the [+]/[-] buttons on the maps). If you're on a border, pick the one that most feels like your neighborhood.

%p
  = @address.full
  %br/
  is currently in 
  = @selected_area.name

- ([@selected_area]+@areas).each do |area|
  .area{:id => dom_id(area)}
    = area.name
    = link_to_function 'Select this one', "$('#user_area_id').val(#{area.id})"


= formatted_form_for @user, :url => new_user_path, :html => {:method => :get} do |f|
  = f.hidden_field :address
  = f.hidden_field :city
  = f.hidden_field :state
  = f.hidden_field :lat
  = f.hidden_field :lng
  - f.fields_for :memberships do |membership|
    = membership.select :area_id, ([@selected_area]+@areas).collect{|a| [a.name, a.id]}
  = f.submit 'Next step', :cancel_url => link_to('Previous', :back)
        
#map_canvas{:style => 'width:300px; height:300px'}

